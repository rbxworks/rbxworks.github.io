<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Verification</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        /* Add some basic styling for the verification page */
        body {
            font-family: 'Poppins', Arial, sans-serif; text-align: center;
            background: linear-gradient(to bottom right, #1e1e1e, #121212); color: #e0e0e0;
            padding: 50px 20px;
        }
        .message { padding: 20px; background-color: rgba(0,0,0,0.3); border-radius: 8px; display: inline-block; }
        .success { color: #5cb85c; }
        .error { color: #d9534f; }
        a { color: #f0c419; }
    </style>
</head>
<body>

    <h1>Task Verification</h1>
    <div id="verificationMessage" class="message">Verifying task completion...</div>
    <p><a href="tasks.html">Return to Task Page</a></p>

    <script>
        // Helper function to format Date object to YYYY-MM-DD
        function formatDateYYYYMMDD(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Gets today's date as YYYY-MM-DD
        function getCurrentDateYYYYMMDD() {
            return formatDateYYYYMMDD(new Date());
        }

        // --- This is the core logic for the verification page ---
        function verifyAndRecordCompletion() {
            const messageElement = document.getElementById("verificationMessage");

            // ======================================================
            // === CRITICAL STEP: Implement actual verification ===
            // ======================================================
            // How do you know the task was completed?
            // Examples: Check URL parameters, check a cookie set by the task site, etc.
            // Replace this placeholder with your real check:
            const taskWasSuccessfullyCompleted = true; // <-- Replace this line!
            // ======================================================


            if (taskWasSuccessfullyCompleted) {
                console.log("Verification check passed.");
                const todayDate = getCurrentDateYYYYMMDD();
                const lastCompletedDate = localStorage.getItem("lastTaskDate");
                let currentStreak = parseInt(localStorage.getItem("streakCounter") || "0");

                // Prevent recording if already done today
                if (lastCompletedDate === todayDate) {
                    messageElement.textContent = "Task already recorded as completed for today! Streak: " + currentStreak;
                    messageElement.className = 'message success'; // Still success, just already done
                    console.log("Verification successful, but already recorded today.");
                    return; // Stop here
                }

                // Calculate new streak
                let newStreak = 1;
                if (lastCompletedDate) {
                    const yesterday = new Date();
                    yesterday.setDate(yesterday.getDate() - 1);
                    const yesterdayDateStr = formatDateYYYYMMDD(yesterday);

                    if (lastCompletedDate === yesterdayDateStr) {
                        newStreak = currentStreak + 1; // Continue streak
                        console.log("Streak continued! New streak:", newStreak);
                    } else {
                        console.log("Streak broken or gap. Resetting streak to 1.");
                        newStreak = 1; // Reset streak
                    }
                } else {
                    console.log("First completion. Starting streak at 1.");
                    newStreak = 1; // First time
                }

                // Save updated data to localStorage
                localStorage.setItem("streakCounter", newStreak);
                localStorage.setItem("lastTaskDate", todayDate);

                messageElement.textContent = "Task completed successfully! Your streak is now " + newStreak + ".";
                messageElement.className = 'message success';
                console.log("Saved to localStorage - Streak:", newStreak, "Date:", todayDate);

            } else {
                // Handle task verification failure
                messageElement.textContent = "Task verification failed. Please ensure you completed the task correctly.";
                messageElement.className = 'message error';
                console.error("Task verification check failed.");
            }
        }

        // Run the verification logic when the page loads
        window.onload = verifyAndRecordCompletion;

    </script>

</body>
</html>
